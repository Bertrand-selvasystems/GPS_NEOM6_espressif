/////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////// DEFINITION DES LIBRAIRIES
/////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////
#include "initialisation.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////// DECLARATION DES FONCTIONS
/////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////

/**
 * @brief Tâche pour initialiser tous les périphériques du système, y compris les capteurs MMC5603 via un multiplexeur I2C TCA9548A.
 */
void system_initialization_task() {
  // reglage du processeur à 240 Mhz.
  esp_pm_config_t pm_config = {
      // avant esp_pm_config_esp32_t
      .max_freq_mhz = 240,
      .min_freq_mhz = 240,
  };
  esp_pm_configure(&pm_config);
  ESP_LOGI("INIT_TASK", "Processeur configuré à 240 Mhz");

  /////////////////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////
  ///////////////////////// INITIALISATION DES VARIABLES
  /////////////////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////

  esp_err_t ret;

  /////////////////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////
  ///////////////////////// DEBUT CYCLE INITIALISATION
  /////////////////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////////////////

  // Initialisation du GPS
  ret = GPS_Init(9600, CONFIG_UART_TX_GPS, CONFIG_UART_RX_GPS);
  if (ret == ESP_OK) {
    ESP_LOGI("INIT_TASK", "UART GPS initialisé avec succès");
  } else {
    ESP_LOGE("INIT_TASK", "Échec de l'initialisation de l'UART GPS : %s", esp_err_to_name(ret));
  }
}
